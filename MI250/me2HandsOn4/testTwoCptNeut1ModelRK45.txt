model
{
  ## PK model: Two compartment with first order absorption
  ## PD model:  Friberg-Karlsson semi-mechanistic model for neutrophil counts
    
    ## PK parameters --- multivariate normal
    theta[1] <- CLHat # CL
    theta[2] <- QHat  # Q
    theta[3] <- V1Hat # V2
    theta[4] <- V2Hat # V3
    theta[5] <- kaHat     # ka

    ## PD parameters --- univariate normals
    theta[6] <- mttHat
    theta[7] <- circ0Hat
    theta[8] <- gamma
    theta[9] <- Emax
    theta[10] <- EC50Hat

    for(j in 1:8){
      theta[10 + j] <- 1                     # Fj
      theta[18 + j] <- 0                     # tlagj
    }

    ## Calculate amounts in each compartment for all event times for the ith individual

    ## Individual predictions
    xhat[1:nobs,1:8] <- TwoCptNeut1ModelRK45(time[1:nobs], amt[1:nobs],
                                             rate[1:nobs], ii[1:nobs],
                                             evid[1:nobs], cmt[1:nobs],
                                             addl[1:nobs], ss[1:nobs],
                                             theta[])
	
    for(i in 1:nobs){

      ## PK data (ME-2 plasma concentrations)
 
      cHat[i] <- 1000 * xhat[i, 2] / theta[3]

      ## PD data (neutrophil counts)

      neutHat[i] <- xhat[i, 8] + theta[7] # xHat[, 8] is CFB
        
    }

  ## Prior distributions

  ## PK parameters --- weakly informative priors

    CLHat <- 10
    QHat <- 1.5 * 10
    V1Hat <- 0.5 * 70
    V2Hat <- 1.5 * 70
    kaHat <- 2
    Emax <- 0.5
    EC50Hat <- 1000
    mttHat <- 125
    circ0Hat <- 5
    gamma <- 0.17
	
}

list(
     nobs = 59,
time=c(0.00000E+00, 0.00000E+00, 8.30000E-02, 1.67000E-01, 2.50000E-01, 5.00000E-01, 7.50000E-01, 1.00000E+00, 1.50000E+00, 2.00000E+00, 3.00000E+00, 4.00000E+00, 6.00000E+00, 8.00000E+00, 1.20000E+01, 1.20830E+01, 1.21670E+01, 1.22500E+01, 1.25000E+01, 1.27500E+01, 1.30000E+01, 1.35000E+01, 1.40000E+01, 1.50000E+01, 1.60000E+01, 1.80000E+01, 2.00000E+01, 2.40000E+01, 3.60000E+01, 4.80000E+01, 6.00000E+01, 7.20000E+01, 8.40000E+01, 9.60000E+01, 1.08000E+02, 1.20000E+02, 1.32000E+02, 1.44000E+02, 1.56000E+02, 1.68000E+02, 1.68083E+02, 1.68167E+02, 1.68250E+02, 1.68500E+02, 1.68750E+02, 1.69000E+02, 1.69500E+02, 1.70000E+02, 1.71000E+02, 1.72000E+02, 1.74000E+02, 1.76000E+02, 1.80000E+02, 1.86000E+02, 1.92000E+02, 2.16000E+02, 2.40000E+02, 2.64000E+02, 2.88000E+02), amt=c(8.00000E+01, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00), rate=c(0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00), ii=c(1.20000E+01, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00), evid=c(1.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00), cmt=c(1.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00, 2.00000E+00), addl=c(1.40000E+01, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00), ss=c(0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00, 0.00000E+00))
